# Keith's Layers (Klayers)

A collection of AWS Lambda Layers for Python3.7

# Status of layers

[![Updates](https://pyup.io/repos/github/keithrozario/Klayers/shield.svg)](https://pyup.io/repos/github/keithrozario/Klayers/)

If the layers are ever outdated, click the badge above for more info.

Full list of publicly available layers by region are [here](arns/).

# Layer List

## Python Packages (in alphabetical order)

| Package        | ARN                                                                             |         
| :------------- |:------------------------------------------------------------------------------- |
aiobotocore| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-aiobotocore:\<*version*> |
aiohttp| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-aiohttp:\<*version*> |
ansible| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-ansible:\<*version*> |
arrow| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-arrow:\<*version*> |
bcrypt| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-bcrypt:\<*version*> |
beautifulsoup4| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-beautifulsoup4:\<*version*> |
boltons| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-boltons:\<*version*> |
boto3| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-boto3:\<*version*> |
construct| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-construct:\<*version*> |
elasticsearch| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-elasticsearch:\<*version*> |
envelopes| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-envelopes:\<*version*> |
ffmpeg-python| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-ffmpeg-python:\<*version*> |
flashtext| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-flashtext:\<*version*> |
google-auth| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-google-auth:\<*version*> |
google-auth-oauthlib| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-google-auth-oauthlib:\<*version*> |
grpcio| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-grpcio:\<*version*> |
gspread| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-gspread:\<*version*> |
idna| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-idna:\<*version*> |
itsdangerous| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-itsdangerous:\<*version*> |
jsonrpclib| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-jsonrpclib:\<*version*> |
kafka-python| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-kafka-python:\<*version*> |
nltk| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-nltk:\<*version*> |
numpy| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-numpy:\<*version*> |
opencv-python-headless| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-opencv-python-headless:\<*version*> |
openpyxl| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-openpyxl:\<*version*> |
pandas| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pandas:\<*version*> |
pickleDB| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pickleDB:\<*version*> |
Pillow| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-Pillow:\<*version*> |
PyJWT| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-PyJWT:\<*version*> |
pymongo| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pymongo:\<*version*> |
PyMUPDF| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-PyMUPDF:\<*version*> |
PyMySQL| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-PyMySQL:\<*version*> |
PyNaCl| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-PyNaCl:\<*version*> |
pyOpenSSL| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pyOpenSSL:\<*version*> |
pyparsing| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pyparsing:\<*version*> |
pytesseract| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pytesseract:\<*version*> |
python-docx| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-python-docx:\<*version*> |
python-Levenshtein| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-python-Levenshtein-wheels:\<*version*> |
pytz| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pytz:\<*version*> |
PyYAML| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-PyYAML:\<*version*> |
requests| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-requests:\<*version*> |
scipy| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-scipy:\<*version*> |
simplejson| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-simplejson:\<*version*> |
SQLAlchemy| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-SQLAlchemy:\<*version*> |
tinydb| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-tinydb:\<*version*> |
tldextract| arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-tldextract:\<*version*> |

## Binaries

Special hand-crafted binaries for layers. These layers are not automatically built, and hence slower update cycles.

| Package        | ARN                                                                             | Version    |         
| :------------- |:------------------------------------------------------------------------------- | ---------- | 
| tesseract      | arn:aws:lambda:\<*region*>:113088814899:layer:Klayers--tesseract:2              | 4.1.0-rc1<sup>1</sup>|
| pip            | arn:aws:lambda:\<*region*>:113088814899:layer:Klayers-python37-pip:2            | 19.2.1     | 

<sup>1</sup> Includes leptonica-1.76.0, libjpeg 6b (libjpeg-turbo 1.2.90) : libpng 1.2.49 : libtiff 4.0.3 : zlib 1.2.8 : libwebp 0.3.0

# Using the Layers

You can either:
* Set any of the ARNs above (for your region) to be a layer for your function. 
* Use the `Get Layer Version by ARN` in [python](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda.html#Lambda.Client.get_layer_version_by_arn) or [bash](https://docs.aws.amazon.com/cli/latest/reference/lambda/get-layer-version-by-arn.html) command which will provide an S3 location to download the layer as a zip

Currently only the following regions have the layers deployed, click on the link for the list of layer arns:

* [ap-northeast-1](arns/ap-northeast-1.json) 
* [ap-northeast-2](arns/ap-northeast-2.json)
* [ap-south-1](arns/ap-south-1.json)
* [ap-southeast-1](arns/ap-southeast-1.json) 
* [ap-southeast-2](arns/ap-southeast-2.json)
* [ca-central-1](arns/ca-central-1json)
* [eu-central-1](arns/eu-central-1.json)
* [eu-north-1](arns/eu-north-1.json)
* [eu-west-1](arns/eu-west-1.json)
* [eu-west-2](arns/eu-west-2.json)
* [eu-west-3](arns/eu-west-3.json)
* [sa-east-1](arns/sa-east-1.json)
* [us-east-1](arns/us-east-1.json)
* [us-east-2](arns/us-east-2.json)
* [us-west-1](arns/us-west-1.json)
* [us-west-2](arns/us-west-2.json)

I tried adding `me-south-1` but got an STS token issue. Will investigate, hang tight Bahrain!

# Layer history

Whenever there is an new version of the underlying package, a new layer **may** be created with an incremented version number.

# Building your own layer

You can use the scripts available in the `infra/` (terraform) and `serverless/` (serverless) directories to build you own lambda layer building pipeline.

For a more old-skool way of deployment using Docker containers, you can refer to the `scripts/build_with_docker` package. Yes, in serverless, Docker Containers are old-skool.


# Layer specific notes

For `pip` you'll need to set your PYTHONPATH to `/opt/python` to override the existing pip inside the lambda environment.

There is an old `spacy` layer -- this has been deprecated.

# Special Thanks

[Chahna107](https://github.com/chahna107) for adding tesseract config files into the tesseract layer.

# To DO
* Cleanup script to delete all lamba layers that are not the latest version (and more than x days old)
* Schedule this to run everyday for production
* Package openssl v1.1.x for better encryption of KEK
* Blog post and architecture review