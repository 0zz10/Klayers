arn_by_regions:
  handler: 07_api/deployed_region.main
  description: Get latest package per region
  runtime: python3.8
  timeout: 10
  memorySize: 256
  environment:
    POWERTOOLS_SERVICE_NAME: Klayers.api
  iamRoleStatementsName: api-arn-region
  iamRoleStatements:
  - Effect: Allow
    Action:
    - dynamodb:Query
    Resource: ${self:custom.dbArn}/index/deployed_in_region
  layers:
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-python38-aws-lambda-powertools:32
  events:
    - httpApi: 'GET /api/v1/latestLayers/{region}'

arn_by_package_region:
  handler: 07_api/latest_package.main
  description: Get latest package per region
  runtime: python3.8
  timeout: 10
  memorySize: 256
  environment:
    POWERTOOLS_SERVICE_NAME: Klayers.api
  iamRoleStatementsName: api-arn-package-region
  iamRoleStatements:
  - Effect: Allow
    Action:
    - dynamodb:GetItem
    Resource: ${self:custom.dbArn}
  layers:
    - arn:aws:lambda:${self:provider.region}:770693421928:layer:Klayers-python38-aws-lambda-powertools:32
  events:
    - httpApi: 'GET /api/v1/latestLayer/{package}/{region}'
